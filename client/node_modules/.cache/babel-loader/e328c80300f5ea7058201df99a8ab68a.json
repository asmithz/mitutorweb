{"ast":null,"code":"import { getter, clone } from '@progress/kendo-react-common';\nimport { parseRule, expand } from '@progress/kendo-recurrence';\nimport { ZonedDate } from '@progress/kendo-date-math';\nimport { toUTCDateTime, setField, isMaster } from '../utils';\n/** @hidden */\n\nexport var toOccurrences = function (data, _a) {\n  var dateRange = _a.dateRange,\n      fields = _a.fields,\n      timezone = _a.timezone;\n  var result = data.map(readItem(fields)).reduce(occurrenceReducer(dateRange, timezone, fields), []).filter(function (occurrence) {\n    return !isMaster(occurrence.dataItem, fields);\n  });\n  return result;\n};\n\nvar readItem = function (fields) {\n  return function (dataItem) {\n    var result = {\n      uid: getter(fields.id || 'id')(dataItem),\n      start: getter(fields.start || 'start')(dataItem),\n      startTimezone: getter(fields.startTimezone || 'startTimezone')(dataItem),\n      originalStart: getter(fields.originalStart || 'originalStart')(dataItem),\n      end: getter(fields.end || 'end')(dataItem),\n      endTimezone: getter(fields.endTimezone || 'endTimezone')(dataItem),\n      isAllDay: getter(fields.isAllDay || 'isAllDay')(dataItem),\n      title: getter(fields.title || 'title')(dataItem),\n      description: getter(fields.description || 'description')(dataItem),\n      occurrenceId: getter('occurrenceId')(dataItem),\n      recurrenceRule: getter(fields.recurrenceRule || 'recurrenceRule')(dataItem),\n      recurrenceExceptions: getter(fields.recurrenceExceptions || 'recurrenceExceptions')(dataItem),\n      recurrenceId: getter(fields.recurrenceId || 'recurrenceId')(dataItem),\n      dataItem: clone(dataItem)\n    };\n    return result;\n  };\n};\n\nvar occurrenceReducer = function (dateRange, timezone, fields) {\n  return function (acc, current) {\n    return acc.concat(Boolean(current.recurrenceRule) && Boolean(current.recurrenceId === null || current.recurrenceId === undefined) && isMaster(current.dataItem, fields) ? occurrences(current, {\n      dateRange: dateRange,\n      timezone: timezone,\n      fields: fields\n    }).slice() : [current]);\n  };\n};\n\nvar occurrences = function (item, _a) {\n  var dateRange = _a.dateRange,\n      timezone = _a.timezone,\n      fields = _a.fields;\n  var rrule = item.recurrenceRule;\n  var rule = parseRule({\n    recurrenceRule: rrule\n  }); // changed as for display purposes timezone of the scheduler is the correct one\n\n  if (!rule.start) {\n    rule.start = ZonedDate.fromLocalDate(item.start, timezone);\n  }\n\n  if (!rule.end) {\n    rule.end = ZonedDate.fromLocalDate(item.end, timezone);\n  }\n\n  var exceptionRule = item.recurrenceExceptions;\n\n  if (exceptionRule) {\n    rule.exceptionDates = exceptionRule.map(function (exDate) {\n      return ZonedDate.fromLocalDate(exDate, timezone);\n    });\n  }\n\n  var utcRangeStart = toUTCDateTime(dateRange.start);\n  var utcRangeEnd = toUTCDateTime(dateRange.end);\n  var series = expand(rule, {\n    rangeStart: ZonedDate.fromUTCDate(utcRangeStart, timezone),\n    rangeEnd: ZonedDate.fromUTCDate(utcRangeEnd, timezone)\n  });\n\n  if (!series.events.length) {\n    return [];\n  }\n\n  var expanded = series.events.map(function (occurrence, idx) {\n    var occurrenceItem = clone(item);\n    var occurrenceDataItem = clone(item.dataItem);\n    occurrenceItem.recurrenceId = occurrenceItem.uid;\n    setField(occurrenceDataItem, fields.recurrenceId, item.uid);\n    occurrenceItem.originalStart = occurrence.start.toLocalDate();\n    setField(occurrenceDataItem, fields.originalStart, occurrence.start.toLocalDate());\n    occurrenceItem.start = occurrence.start.toLocalDate();\n    setField(occurrenceDataItem, fields.start, occurrence.start.toLocalDate());\n    occurrenceItem.end = occurrence.end.toLocalDate();\n    setField(occurrenceDataItem, fields.end, occurrence.end.toLocalDate());\n    occurrenceItem.occurrenceId = String(idx);\n    setField(occurrenceDataItem, 'occurrenceId', String(idx));\n    occurrenceItem.dataItem = occurrenceDataItem;\n    return occurrenceItem;\n  });\n  return expanded;\n};","map":{"version":3,"sources":["/home/asmith/taller/proyecto1/proyecto-taller/client/node_modules/@progress/kendo-react-scheduler/dist/es/services/occurrenceService.js"],"names":["getter","clone","parseRule","expand","ZonedDate","toUTCDateTime","setField","isMaster","toOccurrences","data","_a","dateRange","fields","timezone","result","map","readItem","reduce","occurrenceReducer","filter","occurrence","dataItem","uid","id","start","startTimezone","originalStart","end","endTimezone","isAllDay","title","description","occurrenceId","recurrenceRule","recurrenceExceptions","recurrenceId","acc","current","concat","Boolean","undefined","occurrences","slice","item","rrule","rule","fromLocalDate","exceptionRule","exceptionDates","exDate","utcRangeStart","utcRangeEnd","series","rangeStart","fromUTCDate","rangeEnd","events","length","expanded","idx","occurrenceItem","occurrenceDataItem","toLocalDate","String"],"mappings":"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","sourcesContent":["import { getter, clone } from '@progress/kendo-react-common';\nimport { parseRule, expand } from '@progress/kendo-recurrence';\nimport { ZonedDate } from '@progress/kendo-date-math';\nimport { toUTCDateTime, setField, isMaster } from '../utils';\n/** @hidden */\nexport var toOccurrences = function (data, _a) {\n    var dateRange = _a.dateRange, fields = _a.fields, timezone = _a.timezone;\n    var result = data\n        .map(readItem(fields))\n        .reduce(occurrenceReducer(dateRange, timezone, fields), [])\n        .filter(function (occurrence) { return !isMaster(occurrence.dataItem, fields); });\n    return result;\n};\nvar readItem = function (fields) { return function (dataItem) {\n    var result = {\n        uid: getter(fields.id || 'id')(dataItem),\n        start: getter(fields.start || 'start')(dataItem),\n        startTimezone: getter(fields.startTimezone || 'startTimezone')(dataItem),\n        originalStart: getter(fields.originalStart || 'originalStart')(dataItem),\n        end: getter(fields.end || 'end')(dataItem),\n        endTimezone: getter(fields.endTimezone || 'endTimezone')(dataItem),\n        isAllDay: getter(fields.isAllDay || 'isAllDay')(dataItem),\n        title: getter(fields.title || 'title')(dataItem),\n        description: getter(fields.description || 'description')(dataItem),\n        occurrenceId: getter('occurrenceId')(dataItem),\n        recurrenceRule: getter(fields.recurrenceRule || 'recurrenceRule')(dataItem),\n        recurrenceExceptions: getter(fields.recurrenceExceptions || 'recurrenceExceptions')(dataItem),\n        recurrenceId: getter(fields.recurrenceId || 'recurrenceId')(dataItem),\n        dataItem: clone(dataItem)\n    };\n    return result;\n}; };\nvar occurrenceReducer = function (dateRange, timezone, fields) { return function (acc, current) {\n    return acc.concat(((Boolean(current.recurrenceRule)\n        && Boolean(current.recurrenceId === null || current.recurrenceId === undefined)\n        && isMaster(current.dataItem, fields))\n        ? occurrences(current, { dateRange: dateRange, timezone: timezone, fields: fields }).slice() : [current]));\n}; };\nvar occurrences = function (item, _a) {\n    var dateRange = _a.dateRange, timezone = _a.timezone, fields = _a.fields;\n    var rrule = item.recurrenceRule;\n    var rule = parseRule({ recurrenceRule: rrule });\n    // changed as for display purposes timezone of the scheduler is the correct one\n    if (!rule.start) {\n        rule.start = ZonedDate.fromLocalDate(item.start, timezone);\n    }\n    if (!rule.end) {\n        rule.end = ZonedDate.fromLocalDate(item.end, timezone);\n    }\n    var exceptionRule = item.recurrenceExceptions;\n    if (exceptionRule) {\n        rule.exceptionDates = exceptionRule\n            .map(function (exDate) {\n            return ZonedDate.fromLocalDate(exDate, timezone);\n        });\n    }\n    var utcRangeStart = toUTCDateTime(dateRange.start);\n    var utcRangeEnd = toUTCDateTime(dateRange.end);\n    var series = expand(rule, {\n        rangeStart: ZonedDate.fromUTCDate(utcRangeStart, timezone),\n        rangeEnd: ZonedDate.fromUTCDate(utcRangeEnd, timezone)\n    });\n    if (!series.events.length) {\n        return [];\n    }\n    var expanded = series.events.map(function (occurrence, idx) {\n        var occurrenceItem = clone(item);\n        var occurrenceDataItem = clone(item.dataItem);\n        occurrenceItem.recurrenceId = occurrenceItem.uid;\n        setField(occurrenceDataItem, fields.recurrenceId, item.uid);\n        occurrenceItem.originalStart = occurrence.start.toLocalDate();\n        setField(occurrenceDataItem, fields.originalStart, occurrence.start.toLocalDate());\n        occurrenceItem.start = occurrence.start.toLocalDate();\n        setField(occurrenceDataItem, fields.start, occurrence.start.toLocalDate());\n        occurrenceItem.end = occurrence.end.toLocalDate();\n        setField(occurrenceDataItem, fields.end, occurrence.end.toLocalDate());\n        occurrenceItem.occurrenceId = String(idx);\n        setField(occurrenceDataItem, 'occurrenceId', String(idx));\n        occurrenceItem.dataItem = occurrenceDataItem;\n        return occurrenceItem;\n    });\n    return expanded;\n};\n"]},"metadata":{},"sourceType":"module"}